<!DOCTYPE html>
<html>

<head>
    <title>py-ast Simple Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .success {
            color: green;
            font-weight: bold;
        }

        .error {
            color: red;
            font-weight: bold;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
        }

        code {
            background: #f0f0f0;
            padding: 2px 4px;
        }
    </style>
</head>

<body>
    <h1>py-ast Simple Browser Test</h1>
    <p>Testing py-ast library in browser with simple Python code</p>
    <button onclick="testPyAst()">Test py-ast</button>
    <div id="output"></div>

    <script type="module">
        import * as pyAst from './node_modules/py-ast/dist/index.esm.js';
        window.pyAst = pyAst; // Make available to button click

        window.testPyAst = function () {
            const output = document.getElementById('output');

            try {
                output.innerHTML = 'Testing py-ast...<br>';

                // Test simple Python code
                const testCode = `def greet(name="World"):
    """Say hello to someone"""
    if name:
        return f"Hello, {name}!"
    else:
        return "Hello!"

result = greet("Python")`;

                output.innerHTML += `<strong>Test Code:</strong><br><pre>${testCode}</pre>`;

                // Parse the code
                const ast = pyAst.parse(testCode);
                output.innerHTML += '<span class="success">âœ“ Parse successful!</span><br>';

                // Basic AST info
                output.innerHTML += `<strong>AST Info:</strong><br>`;
                output.innerHTML += `- Node Type: ${ast.nodeType}<br>`;
                output.innerHTML += `- Body Length: ${ast.body ? ast.body.length : 0}<br>`;

                // Walk the AST to find functions
                const functions = [];
                pyAst.walk(ast, {
                    FunctionDef: (node) => {
                        functions.push({
                            name: node.name,
                            params: node.args.args.map(arg => arg.arg),
                            defaults: node.args.defaults.length,
                            docstring: pyAst.getDocstring(node)
                        });
                    }
                });

                output.innerHTML += `<strong>Analysis Results:</strong><br>`;
                output.innerHTML += `- Functions found: ${functions.length}<br>`;

                if (functions.length > 0) {
                    const func = functions[0];
                    output.innerHTML += `- Function name: "${func.name}"<br>`;
                    output.innerHTML += `- Parameters: [${func.params.join(', ')}]<br>`;
                    output.innerHTML += `- Default parameters: ${func.defaults}<br>`;
                    output.innerHTML += `- Has docstring: ${func.docstring ? 'Yes' : 'No'}<br>`;
                    if (func.docstring) {
                        output.innerHTML += `- Docstring: "${func.docstring}"<br>`;
                    }
                }

                output.innerHTML += '<br><span class="success">ðŸŽ‰ All tests passed! py-ast is working perfectly!</span>';

            } catch (error) {
                output.innerHTML += `<span class="error">âœ— ERROR:</span> ${error.message}<br>`;
                output.innerHTML += `<strong>Stack:</strong><pre>${error.stack}</pre>`;
                console.error('py-ast test failed:', error);
            }
        }
    </script>
</body>

</html>