<!DOCTYPE html>
<html>

<head>
    <title>Debug Replay System</title>
    <script>
        // Simple test to verify replay functionality
        window.__SSG_DEBUG = true;

        // Mock CodeMirror for testing
        window.cm = {
            addLineClass: function (line, type, className) {
                console.log(`addLineClass: line ${line}, type ${type}, class ${className}`);
            },
            removeLineClass: function (line, type, className) {
                console.log(`removeLineClass: line ${line}, type ${type}, class ${className}`);
            },
            addLineWidget: function (line, element, options) {
                console.log(`addLineWidget: line ${line}, element:`, element, 'options:', options);
                return {
                    clear: function () {
                        console.log('Widget cleared');
                    }
                };
            },
            charCoords: function () { return { top: 0, left: 0 }; },
            scrollIntoView: function (pos) {
                console.log(`scrollIntoView: ${JSON.stringify(pos)}`);
            },
            getWrapperElement: function () {
                return {
                    classList: {
                        add: function (cls) { console.log(`Add class: ${cls}`); },
                        remove: function (cls) { console.log(`Remove class: ${cls}`); }
                    }
                };
            }
        };

        // Mock DOM elements
        function $(id) {
            const mockElement = {
                addEventListener: function (event, handler) {
                    console.log(`Event listener added to ${id}: ${event}`);
                },
                disabled: false,
                style: { display: 'none' },
                value: 0
            };
            return mockElement;
        }

        window.$ = $;

        // Mock terminal debug
        function appendTerminalDebug(msg) {
            console.log(`[DEBUG] ${msg}`);
        }

        window.appendTerminalDebug = appendTerminalDebug;
    </script>

    <script type="module">
        // Import and test the replay system
        import { ExecutionRecorder, ExecutionTrace, ExecutionStep } from './src/js/execution-recorder.js';
        import { ReplayEngine, ReplayLineDecorator, ReplayUI } from './src/js/replay-ui.js';

        console.log('Starting replay debug test...');

        // Create a mock execution trace
        const trace = new ExecutionTrace();

        // Add some test steps with variables
        const vars1 = new Map([['x', '64'], ['y', '"hello"']]);
        const step1 = new ExecutionStep(9, vars1, 'global');
        trace.addStep(step1);

        const vars2 = new Map([['x', '64'], ['y', '"hello"'], ['z', '69']]);
        const step2 = new ExecutionStep(10, vars2, 'global');
        trace.addStep(step2);

        console.log(`Created trace with ${trace.getStepCount()} steps`);

        // Create replay engine and test
        const engine = new ReplayEngine();
        console.log('Starting replay...');

        const success = engine.startReplay(trace);
        console.log(`Replay start result: ${success}`);

        if (success) {
            console.log('Testing step forward...');
            engine.stepForward();

            console.log('Testing step backward...');
            engine.stepBackward();

            console.log('Testing jump to step...');
            engine.jumpToStep(1);
        }
    </script>
</head>

<body>
    <h1>Replay Debug Test</h1>
    <p>Check console for debug output...</p>
</body>

</html>